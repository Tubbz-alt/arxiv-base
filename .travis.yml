language: python
sudo: required
services:
  - docker
cache: pip
os:
  - linux
python:
  - "3.6"
jobs:
  include:
    - stage: dependencies
      script: pip install pipenv && pipenv install --dev && pipenv install ./
    - stage: test
      script: pipenv run nose2 -s arxiv --with-coverage && coveralls
    - stage: lint
      script: ./tests/lintstats.sh
    - stage: deploy
      if: tag IS present
      script: pipenv install --dev twine && python setup.py sdist && twine upload -u ${PYPI_USERNAME} -p ${PYPI_PASSWORD} dist/*
