
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>arxiv.integration.meta module &#8212; arXiv base 0.2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="arxiv.license package" href="arxiv.license.html" />
    <link rel="prev" title="arxiv.integration.kinesis.consumer.exceptions module" href="arxiv.integration.kinesis.consumer.exceptions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-arxiv.integration.meta">
<span id="arxiv-integration-meta-module"></span><h1>arxiv.integration.meta module<a class="headerlink" href="#module-arxiv.integration.meta" title="Permalink to this headline">¶</a></h1>
<p>Meta tools for integrations.</p>
<dl class="class">
<dt id="arxiv.integration.meta.MetaIntegration">
<em class="property">class </em><code class="sig-prename descclassname">arxiv.integration.meta.</code><code class="sig-name descname">MetaIntegration</code><a class="reference internal" href="../_modules/arxiv/integration/meta.html#MetaIntegration"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#arxiv.integration.meta.MetaIntegration" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.6/library/functions.html#type" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></a></p>
<p>Metaclass for context-bound integrations.</p>
<p>The purpose of this metaclass is to simplify writing integrations that
need to attach to the application or request context.</p>
<p>A typical pattern  when using an integration’s method is to first check for
an instance of the integration on the current context, and then call the
method on that instance. In practice, this means either performing the
context check  every time the method is used (yuck) or implementing
module-level functions that wrap the integration class instance methods,
and check the context when called (also yuck).</p>
<p>Here’s an example of what life was like back then:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FileManagementService</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Encapsulates a connection with the file management service.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">get_upload_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upload_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Upload</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">def</span> <span class="nf">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Set default configuration params for an application instance.&#39;&#39;&#39;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_application_config</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_ENDPOINT&#39;</span><span class="p">,</span> <span class="s1">&#39;https://arxiv.org/&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_VERIFY&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileManagementService</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Get a new session with the file management endpoint.&#39;&#39;&#39;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_application_config</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_ENDPOINT&#39;</span><span class="p">,</span> <span class="s1">&#39;https://arxiv.org/&#39;</span><span class="p">)</span>
    <span class="n">verify_cert</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_VERIFY&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FileManagementService</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">verify_cert</span><span class="o">=</span><span class="n">verify_cert</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">current_session</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">FileManagementService</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Get/create :class:`.FileManagementService` for this context.&#39;&#39;&#39;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">get_application_global</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_session</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s1">&#39;filemanager&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">filemanager</span> <span class="o">=</span> <span class="n">get_session</span><span class="p">()</span>   <span class="c1"># type: ignore</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">filemanager</span>    <span class="c1"># type: ignore</span>

<span class="nd">@wraps</span><span class="p">(</span><span class="n">FileManagementService</span><span class="o">.</span><span class="n">get_upload_status</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_upload_status</span><span class="p">(</span><span class="n">upload_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Upload</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;See :meth:`FileManagementService.get_upload_status`.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">current_session</span><span class="p">()</span><span class="o">.</span><span class="n">get_upload_status</span><span class="p">(</span><span class="n">upload_id</span><span class="p">)</span>
</pre></div>
</div>
<p>and then when you want to use it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">my.cool.services</span> <span class="kn">import</span> <span class="n">filemanager</span>

<span class="n">filemanager</span><span class="o">.</span><span class="n">get_upload_status</span><span class="p">(</span><span class="mi">59192</span><span class="p">)</span>
</pre></div>
</div>
<p>Classes that use this metaclass are expected to implement a classmethod
called <code class="docutils literal notranslate"><span class="pre">current_session()</span></code> that returns an instance of the class, similar
to the example above. That method is responsible for getting the correct
instance for the context.</p>
<p>The net effect is that instance methods will be exposed as if they were
class methods; behind the scenes, this metaclass will call
<code class="docutils literal notranslate"><span class="pre">current_session()</span></code> and obtain the bound method from the returned
instance.</p>
<p>So you can do something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FileManagementService</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">MetaIntegration</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Encapsulates a connection with the file management service.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">get_upload_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upload_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Upload</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_app</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Set default configuration params for an application instance.&#39;&#39;&#39;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_application_config</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_ENDPOINT&#39;</span><span class="p">,</span> <span class="s1">&#39;https://arxiv.org/&#39;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_VERIFY&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;FileManagementService&#39;</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Get a new session with the file management endpoint.&#39;&#39;&#39;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_application_config</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_ENDPOINT&#39;</span><span class="p">,</span> <span class="s1">&#39;https://arxiv.org/&#39;</span><span class="p">)</span>
        <span class="n">verify_cert</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FILE_MANAGER_VERIFY&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">verify_cert</span><span class="o">=</span><span class="n">verify_cert</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">current_session</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;FileManagementService&#39;</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Get/create :class:`.FileManagementService` for this context.&#39;&#39;&#39;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">get_application_global</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;filemanager&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">filemanager</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_session</span><span class="p">()</span>   <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">filemanager</span>    <span class="c1"># type: ignore</span>
</pre></div>
</div>
<p>and then use it like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">my.cool.services.filemanager</span> <span class="kn">import</span> <span class="n">FileManager</span>

<span class="n">FileManager</span><span class="o">.</span><span class="n">get_upload_status</span><span class="p">(</span><span class="mi">59192</span><span class="p">)</span>
</pre></div>
</div>
<p>The example above was only a marginal improvement. What would be better
is not having to write any of those classmethods at all.</p>
<p>For an example of what that looks like, see
<a class="reference internal" href="arxiv.integration.api.service.html#arxiv.integration.api.service.HTTPIntegration" title="arxiv.integration.api.service.HTTPIntegration"><code class="xref py py-class docutils literal notranslate"><span class="pre">api.service.HTTPIntegration</span></code></a>.</p>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">arXiv base</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">arxiv</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arxiv.base.html">arxiv.base package</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.forms.html">arxiv.forms package</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.identifier.html">arxiv.identifier package</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="arxiv.integration.html">arxiv.integration package</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.license.html">arxiv.license package</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.mail.html">arxiv.mail package</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.status.html">arxiv.status package</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.taxonomy.html">arxiv.taxonomy package</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.util.html">arxiv.util package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="metadocs.html">Meta-documentation: How to create documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="modules.html">arxiv</a><ul>
  <li><a href="arxiv.integration.html">arxiv.integration package</a><ul>
      <li>Previous: <a href="arxiv.integration.kinesis.consumer.exceptions.html" title="previous chapter">arxiv.integration.kinesis.consumer.exceptions module</a></li>
      <li>Next: <a href="arxiv.license.html" title="next chapter">arxiv.license package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, arXiv Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/arxiv/arxiv.integration.meta.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>